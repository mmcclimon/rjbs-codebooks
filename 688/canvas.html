<html>
  <div style='display:flex; align-items: center; align-content: center; justify-content: center; width:100%; height: 100%; outline: thick blue solid'>
    <canvas style='outline:thin black solid' id='canvas' width=500 height=500 />
  </div>
  <script type='text/javascript'>
    var player = { x: 200, y: 250 };

    var target  = "Setec Astronomy";
    var chars   = target.split('');
    var hidden  = new Set( chars.keys() );
    var pick    = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');

    const randInt = i => Math.floor( Math.random() * i );

    const getRandom = s => [...s.values()][ randInt(s.size) ];

    function nextStringState () {
      if (hidden.size == 0) return { random: "", found: target };

      if (Math.random() > 0.98) hidden.delete( getRandom(hidden) );

      let state = {};
      state.random = chars.map(
        (c, i) => hidden.has(i) ? pick[ randInt(pick.length) ] : ' ')
        .join('');

      state.found  = chars.map((c, i) => hidden.has(i) ? ' ' : c).join('');

      return state;
    }

    var mobs = [];

    var tick = 0;
    var turnsTaken = 0;

    function draw() {
      tick++;
      var canvas = document.getElementById('canvas');
      if (canvas.getContext) {
        var ctx = canvas.getContext('2d');

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // The Wonky Blue Line
        ctx.beginPath();
        ctx.strokeStyle = 'blue';
        ctx.moveTo(0, 100);

        const tock = tick % 401;
        const dy   = (tock > 200 ? 400 - tock : tock) - 100;
        const dx   = dy / 2;

        ctx.bezierCurveTo(200 + dx, 100 - dy, 300 + dx, 100 + dy, 500, 100);
        ctx.stroke();

        // The Scrambler
        let stringState = nextStringState();
        ctx.font = '48px monospace';

        ctx.fillStyle = 'red';
        ctx.fillText(stringState.random, 35, 50);

        ctx.fillStyle = 'green';
        ctx.fillText(stringState.found, 35, 50);

        // The Adventurer
        ctx.strokeStyle = 'orange';
        ctx.fillStyle   = 'purple';
        ctx.beginPath();
        ctx.arc(player.x, player.y, 20, 0, 2 * Math.PI);
        ctx.fill();

        // Mobs
        mobs.forEach(mob => {
          if (mob.isDead) return;

          ctx.strokeStyle = 'orange';
          ctx.fillStyle   = mob.type == 'even' ? 'pink' : 'orange';

          ctx.beginPath();
          ctx.arc(mob.x, mob.y, 20, 0, 2 * Math.PI);
          ctx.fill();
        });

        // Turn Count
        ctx.font = '24px monospace';
        ctx.fillStyle = 'blue';
        ctx.fillText(`turn ${turnsTaken}`, 375, 490);
      }

      window.requestAnimationFrame(draw);
    }
    window.requestAnimationFrame(draw);

    mobs.push({ x: 25, y: 100, type: 'even' });

    function takeTurn() {
      console.log("turn taken");

      mobs.forEach(mob => {
        if (mob.x == player.x && mob.y == player.y) {
          console.log("It dead.");
          mob.isDead = true;
        }

        if (mob.isDead) return;

        if (mob.type == 'even' && turnsTaken % 2 == 0) return;
        if (mob.type == 'odd'  && turnsTaken % 2 == 1) return;

        const dir = Math.floor( 4 * Math.random() );
        if (dir == 0) { if (mob.x >  50) mob.x -= 25; }
        if (dir == 1) { if (mob.y < 450) mob.y += 25; }
        if (dir == 2) { if (mob.y >  50) mob.y -= 25; }
        if (dir == 3) { if (mob.x < 450) mob.x += 25; }

      });

      turnsTaken++;

      if (turnsTaken % 37 == 0) {
        const newMob = {
          x: (Math.floor( Math.random() * 9 ) + 1) * 25,
          y: (Math.floor( Math.random() * 9 ) + 1) * 25,
          type: (Math.random() > 0.5 ? 'even' : 'odd'),
        };

        mobs.push(newMob);
      }
    }

    document.addEventListener("keyup", event => {
      const code = event.code;
      if (code == 'KeyH') { if (player.x >  50) player.x -= 25; takeTurn(); }
      if (code == 'KeyJ') { if (player.y < 450) player.y += 25; takeTurn(); }
      if (code == 'KeyK') { if (player.y >  50) player.y -= 25; takeTurn(); }
      if (code == 'KeyL') { if (player.x < 450) player.x += 25; takeTurn(); }
    });
  </script>
</html>
